<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leo Xu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                tags: 'ams'
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore'
            },
            startup: { typeset: false }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link id="hljs-light" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
    <link id="hljs-dark" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark.min.css" disabled>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #fafafa;
            --text-color: #1a1a1a;
            --text-muted-color: #666666;
            --primary-accent-color: #111111;
            --primary-accent-hover-color: #333333;
            --card-bg-color: rgba(235, 235, 235, 0.45);
            --card-border-color: rgba(200, 200, 200, 0.25);
            --header-bg-color: rgba(250, 250, 250, 0.72);
            --shadow-color-light: rgba(0,0,0,0.06);
            --shadow-color-medium: rgba(0,0,0,0.03);
            --sidebar-hover-bg: rgba(0,0,0,0.05);
            --sidebar-active-bg: rgba(0,0,0,0.08);
            --pre-bg-color: #f0f0f0;
            --pre-text-color: #1a1a1a;
            --glow-color: rgba(0, 0, 0, 0.5);
            --glow-color-intense: rgba(0, 0, 0, 0.8);
            --callout-note: #448aff;
            --callout-tip: #00c853;
            --callout-warning: #ff9100;
            --callout-danger: #ff1744;
            --callout-info: #448aff;
            --callout-example: #7c4dff;
        }

        html.dark {
            --bg-color: #0a0a0a;
            --text-color: #e8e8e8;
            --text-muted-color: #999999;
            --primary-accent-color: #f0f0f0;
            --primary-accent-hover-color: #cccccc;
            --card-bg-color: rgba(28, 28, 28, 0.55);
            --card-border-color: rgba(55, 55, 55, 0.35);
            --header-bg-color: rgba(12, 12, 12, 0.75);
            --shadow-color-light: rgba(255,255,255,0.04);
            --shadow-color-medium: rgba(255,255,255,0.02);
            --sidebar-hover-bg: rgba(255,255,255,0.06);
            --sidebar-active-bg: rgba(255,255,255,0.1);
            --pre-bg-color: #1a1a1a;
            --pre-text-color: #e8e8e8;
            --glow-color: rgba(255, 255, 255, 0.5);
            --glow-color-intense: rgba(255, 255, 255, 0.8);
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            margin: 0;
        }

        /* ===== Frosted Glass ===== */
        .frosted-glass {
            background-color: var(--card-bg-color);
            backdrop-filter: blur(12px) saturate(120%);
            -webkit-backdrop-filter: blur(12px) saturate(120%);
            border: 1px solid var(--card-border-color);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px var(--shadow-color-light), 0 2px 4px -1px var(--shadow-color-medium);
        }

        .header-frosted {
            background-color: var(--header-bg-color);
            backdrop-filter: blur(14px) saturate(150%);
            -webkit-backdrop-filter: blur(14px) saturate(150%);
            box-shadow: 0 2px 10px var(--shadow-color-light);
        }

        /* ===== Header & Navigation ===== */
        nav.main-nav { position: relative; display: flex; }

        .tab {
            color: var(--text-muted-color);
            background: transparent;
            border: none;
            padding: 0.75rem 1.25rem;
            margin: 0 0.15rem;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            outline: none;
            position: relative;
            transition: color 0.3s ease;
            border-radius: 0.75rem;
        }
        .tab:hover { color: var(--primary-accent-color); background: var(--sidebar-hover-bg); }
        .tab.tab-active-text { color: var(--primary-accent-color) !important; font-weight: 700; }

        #active-tab-underline {
            position: absolute;
            bottom: 0;
            height: 3px;
            background-color: var(--primary-accent-color);
            border-radius: 2px;
            box-shadow: 0 0 10px 1px var(--glow-color);
            transition: left 0.3s cubic-bezier(0.65, 0, 0.35, 1), width 0.3s cubic-bezier(0.65, 0, 0.35, 1);
            z-index: 0;
        }

        /* ===== Theme Toggle ===== */
        .theme-switch-wrapper { display: flex; align-items: center; }
        .theme-switch { display: inline-block; height: 24px; position: relative; width: 44px; margin-left: 1rem; }
        .theme-switch input { display: none; }
        .slider {
            background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0;
            transition: .4s; border-radius: 24px;
            box-shadow: 0 0 5px 0px var(--glow-color);
        }
        html.dark .slider { background-color: #333; }
        .slider:before {
            background-color: var(--bg-color);
            bottom: 3px; content: ""; height: 18px; left: 3px; position: absolute;
            transition: .4s; width: 18px; border-radius: 50%;
            box-shadow: 0 0 5px 1px var(--glow-color-intense);
        }
        input:checked + .slider { background-color: var(--primary-accent-color); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* ===== Wiki Layout (3-column) ===== */
        .wiki-layout {
            display: flex;
            gap: 1rem;
            min-height: calc(100vh - 180px);
            align-items: flex-start;
        }

        .wiki-nav-panels { display: contents; }

        .wiki-categories {
            width: 180px;
            flex-shrink: 0;
            position: sticky;
            top: 80px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            padding: 0.85rem;
        }

        .wiki-articles {
            width: 240px;
            flex-shrink: 0;
            position: sticky;
            top: 80px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            padding: 1rem;
        }

        .wiki-content-wrapper {
            flex: 1;
            min-width: 0;
        }

        /* ===== Category Column ===== */
        .categories-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--primary-accent-color);
            padding: 0.15rem 0.5rem 0.75rem;
            border-bottom: 1px solid var(--card-border-color);
            margin-bottom: 0.6rem;
        }

        /* ===== Section Headers ===== */
        .section-block { margin-bottom: 0.25rem; }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.5rem;
            cursor: pointer;
            user-select: none;
            border-radius: 0.5rem;
            transition: background 0.2s ease;
        }
        .section-header:hover { background: var(--sidebar-hover-bg); }
        .section-label {
            font-size: 0.72rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-muted-color);
        }
        .section-chevron {
            font-size: 0.55rem;
            color: var(--text-muted-color);
            transition: transform 0.2s ease;
            margin-left: auto;
        }
        .section-header.collapsed .section-chevron { transform: rotate(-90deg); }

        .section-categories {
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.2s ease;
            max-height: 500px;
            opacity: 1;
        }
        .section-categories.collapsed { max-height: 0; opacity: 0; }

        .category-item {
            padding: 0.45rem 0.6rem 0.45rem 0.85rem;
            border-radius: 0.6rem;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.84rem;
            color: var(--text-muted-color);
            transition: all 0.2s ease;
            margin-bottom: 0.1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .category-item:hover {
            background: var(--sidebar-hover-bg);
            color: var(--text-color);
        }
        .category-item.active {
            background: var(--sidebar-active-bg);
            color: var(--primary-accent-color);
            font-weight: 600;
        }

        /* ===== Articles Column ===== */
        .articles-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--primary-accent-color);
            padding: 0.1rem 0.25rem 0.65rem;
            border-bottom: 1px solid var(--card-border-color);
            margin-bottom: 0.6rem;
        }

        /* ===== Sidebar Search ===== */
        .sidebar-search {
            position: relative;
            margin-bottom: 0.75rem;
        }
        .sidebar-search input {
            width: 100%;
            padding: 0.5rem 2rem 0.5rem 2rem;
            border-radius: 0.65rem;
            border: 1px solid var(--card-border-color);
            background: var(--sidebar-hover-bg);
            color: var(--text-color);
            font-size: 0.82rem;
            outline: none;
            transition: border-color 0.2s ease;
            font-family: inherit;
        }
        .sidebar-search input:focus { border-color: var(--primary-accent-color); }
        .sidebar-search input::placeholder { color: var(--text-muted-color); }
        .sidebar-search-icon {
            position: absolute;
            left: 0.6rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted-color);
            pointer-events: none;
        }
        .sidebar-search-clear {
            position: absolute;
            right: 0.4rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted-color);
            cursor: pointer;
            padding: 0.2rem;
            border-radius: 50%;
            display: none;
            line-height: 1;
        }
        .sidebar-search-clear:hover { color: var(--text-color); }

        .sidebar-article {
            display: block;
            padding: 0.5rem 0.65rem;
            border-radius: 0.55rem;
            cursor: pointer;
            font-size: 0.84rem;
            color: var(--text-muted-color);
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            margin: 1px 0;
            text-decoration: none;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .sidebar-article:hover {
            background: var(--sidebar-hover-bg);
            color: var(--text-color);
        }
        .sidebar-article.active {
            background: var(--sidebar-active-bg);
            color: var(--primary-accent-color);
            font-weight: 600;
            border-left-color: var(--primary-accent-color);
        }

        .articles-empty {
            padding: 0.5rem 0.25rem;
            font-size: 0.82rem;
            color: var(--text-muted-color);
            font-style: italic;
        }

        /* ===== Wiki Content Card ===== */
        .wiki-content-card {
            padding: 2rem 2.5rem;
            min-height: 500px;
        }

        .article-meta {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
        }

        .article-category-badge {
            display: inline-block;
            padding: 0.25rem 0.85rem;
            border-radius: 999px;
            font-size: 0.78rem;
            font-weight: 600;
            background: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
            letter-spacing: 0.02em;
        }

        .article-date {
            font-size: 0.8rem;
            color: var(--text-muted-color);
        }

        .article-tags { display: flex; flex-wrap: wrap; gap: 0.35rem; }
        .article-tag {
            display: inline-block;
            padding: 0.15rem 0.6rem;
            border-radius: 999px;
            font-size: 0.72rem;
            font-weight: 500;
            background: var(--sidebar-hover-bg);
            color: var(--text-muted-color);
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--card-border-color);
        }
        .article-tag:hover {
            color: var(--primary-accent-color);
            border-color: var(--primary-accent-color);
        }

        /* ===== Wiki Welcome View ===== */
        .wiki-welcome { text-align: center; padding: 3rem 1rem; }
        .wiki-welcome h2 { font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; }
        .wiki-welcome p { color: var(--text-muted-color); margin-bottom: 2.5rem; font-size: 1.05rem; }

        .category-card {
            padding: 1.5rem;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-align: left;
        }
        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-color-light);
        }
        .category-card h3 { font-size: 1.15rem; font-weight: 600; margin-bottom: 0.3rem; }
        .category-card .card-count { font-size: 0.85rem; color: var(--text-muted-color); }

        /* ===== Markdown Content (wiki-viewer) ===== */
        .wiki-viewer { color: var(--text-color); line-height: 1.8; }
        .wiki-viewer > *:first-child { margin-top: 0; }
        .wiki-viewer > *:last-child { margin-bottom: 0; }

        .wiki-viewer h1, .wiki-viewer h2, .wiki-viewer h3,
        .wiki-viewer h4, .wiki-viewer h5, .wiki-viewer h6 {
            font-weight: 600;
            margin-top: 1.6em;
            margin-bottom: 0.7em;
            line-height: 1.35;
            color: var(--text-color);
        }
        .wiki-viewer h1 { font-size: 1.9em; }
        .wiki-viewer h2 { font-size: 1.5em; border-bottom: 1px solid var(--card-border-color); padding-bottom: 0.3em; }
        .wiki-viewer h3 { font-size: 1.25em; }
        .wiki-viewer h4 { font-size: 1.1em; }

        .wiki-viewer p { margin-bottom: 1em; }
        .wiki-viewer a { color: var(--primary-accent-color); text-decoration: underline; text-underline-offset: 2px; }
        .wiki-viewer a:hover { opacity: 0.75; }

        .wiki-viewer pre {
            background-color: var(--pre-bg-color);
            color: var(--pre-text-color);
            padding: 1.15em;
            border-radius: 0.75rem;
            overflow-x: auto;
            font-family: 'Fira Code', Consolas, 'Courier New', monospace;
            font-size: 0.88em;
            line-height: 1.55;
            margin: 1.2em 0;
            border: 1px solid var(--card-border-color);
        }
        .wiki-viewer code:not(pre code) {
            font-family: 'Fira Code', Consolas, 'Courier New', monospace;
            background-color: var(--pre-bg-color);
            color: var(--pre-text-color);
            padding: 0.15em 0.4em;
            border-radius: 0.35rem;
            font-size: 0.88em;
        }
        .wiki-viewer pre code {
            background: none;
            padding: 0;
            border-radius: 0;
            font-size: inherit;
        }

        /* ===== Code Copy Button ===== */
        .code-block-wrapper {
            position: relative;
        }
        .code-block-wrapper pre {
            margin: 0;
        }
        .copy-btn {
            position: absolute;
            top: 0.55rem;
            right: 0.55rem;
            padding: 0.35rem;
            border-radius: 0.5rem;
            border: 1px solid var(--card-border-color);
            background: var(--pre-bg-color);
            color: var(--text-muted-color);
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease, color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }
        .code-block-wrapper:hover .copy-btn { opacity: 1; }
        .copy-btn:hover { color: var(--text-color); }
        .copy-btn.copied { color: var(--callout-tip); opacity: 1; }

        .wiki-viewer ul, .wiki-viewer ol {
            margin-left: 0;
            padding-left: 1.75em;
            margin-bottom: 1em;
        }
        .wiki-viewer li { margin-bottom: 0.4em; }
        .wiki-viewer li > p:first-child { margin-top: 0; }
        .wiki-viewer li > p:last-child { margin-bottom: 0; }
        .wiki-viewer ul { list-style-type: disc; }
        .wiki-viewer ol { list-style-type: decimal; }
        .wiki-viewer ul ul, .wiki-viewer ol ol,
        .wiki-viewer ul ol, .wiki-viewer ol ul {
            margin-left: 1.5em;
            margin-top: 0.3em;
            margin-bottom: 0.3em;
        }

        .wiki-viewer blockquote {
            border-left: 4px solid var(--primary-accent-color);
            padding: 0.5em 1em;
            margin: 1em 0;
            border-radius: 0 0.5rem 0.5rem 0;
            background: var(--sidebar-hover-bg);
            color: var(--text-muted-color);
        }
        .wiki-viewer blockquote p { margin-bottom: 0.3em; }

        .wiki-viewer hr {
            border: 0;
            height: 1px;
            background-color: var(--card-border-color);
            margin: 2em 0;
        }

        .wiki-viewer table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 1.2em 0;
            border-radius: 0.75rem;
            overflow: hidden;
            border: 1px solid var(--card-border-color);
        }
        .wiki-viewer th, .wiki-viewer td {
            padding: 0.65em 1em;
            text-align: left;
            border-bottom: 1px solid var(--card-border-color);
        }
        .wiki-viewer th {
            background: var(--sidebar-hover-bg);
            font-weight: 600;
            font-size: 0.9em;
        }
        .wiki-viewer tr:last-child td { border-bottom: none; }

        .wiki-viewer img {
            max-width: 100%;
            border-radius: 0.75rem;
            margin: 1em 0;
        }

        .wiki-viewer mark {
            background: rgba(255, 213, 0, 0.3);
            padding: 0.1em 0.25em;
            border-radius: 0.25rem;
        }
        html.dark .wiki-viewer mark { background: rgba(255, 213, 0, 0.18); }

        .wiki-viewer input[type="checkbox"] {
            margin-right: 0.4em;
            pointer-events: none;
        }

        /* ===== Callouts (Obsidian-style) ===== */
        .callout {
            border-radius: 0.75rem;
            padding: 1rem 1.25rem;
            margin: 1.2em 0;
            border-left: 4px solid;
        }
        .callout-header {
            font-weight: 600;
            margin-bottom: 0.4rem;
            font-size: 0.95em;
        }
        .callout-body { font-size: 0.93em; }
        .callout-body p:last-child { margin-bottom: 0; }

        .callout-note, .callout-info {
            border-color: var(--callout-note);
            background: rgba(68, 138, 255, 0.07);
        }
        .callout-note .callout-header, .callout-info .callout-header { color: var(--callout-note); }

        .callout-tip, .callout-hint {
            border-color: var(--callout-tip);
            background: rgba(0, 200, 83, 0.07);
        }
        .callout-tip .callout-header, .callout-hint .callout-header { color: var(--callout-tip); }

        .callout-warning, .callout-caution, .callout-attention {
            border-color: var(--callout-warning);
            background: rgba(255, 145, 0, 0.07);
        }
        .callout-warning .callout-header, .callout-caution .callout-header,
        .callout-attention .callout-header { color: var(--callout-warning); }

        .callout-danger, .callout-important, .callout-error {
            border-color: var(--callout-danger);
            background: rgba(255, 23, 68, 0.07);
        }
        .callout-danger .callout-header, .callout-important .callout-header,
        .callout-error .callout-header { color: var(--callout-danger); }

        .callout-example, .callout-abstract, .callout-summary {
            border-color: var(--callout-example);
            background: rgba(124, 77, 255, 0.07);
        }
        .callout-example .callout-header, .callout-abstract .callout-header,
        .callout-summary .callout-header { color: var(--callout-example); }

        .callout-quote {
            border-color: var(--text-muted-color);
            background: var(--sidebar-hover-bg);
        }
        .callout-quote .callout-header { color: var(--text-muted-color); }

        /* ===== MathJax ===== */
        mjx-container {
            display: inline-block;
            line-height: 0;
            text-align: left;
            vertical-align: baseline;
            margin: 0 0.1em;
        }
        mjx-container[display="true"] {
            display: block;
            overflow-x: auto;
            overflow-y: hidden;
            margin: 1em 0;
            line-height: normal;
            text-align: center;
        }

        /* ===== Scrollbar ===== */
        .wiki-articles::-webkit-scrollbar { width: 5px; }
        .wiki-articles::-webkit-scrollbar-thumb { background: var(--text-muted-color); border-radius: 3px; opacity: 0.4; }
        .wiki-articles::-webkit-scrollbar-track { background: transparent; }

        /* ===== Mobile Sidebar ===== */
        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            z-index: 90;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .sidebar-overlay.open { display: block; opacity: 1; }

        #mobileSidebarToggle { display: none; }

        @media (max-width: 768px) {
            .wiki-layout { flex-direction: column; }

            .wiki-nav-panels {
                display: flex;
                flex-direction: column;
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                width: 300px;
                z-index: 100;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                border-radius: 0 1rem 1rem 0;
                background-color: var(--card-bg-color);
                backdrop-filter: blur(12px) saturate(120%);
                -webkit-backdrop-filter: blur(12px) saturate(120%);
                border: 1px solid var(--card-border-color);
                padding: 1rem;
                gap: 0.5rem;
                overflow-y: auto;
            }
            .wiki-nav-panels.open { transform: translateX(0); }

            .wiki-categories {
                display: flex;
                flex-wrap: wrap;
                gap: 0.35rem;
                width: auto;
                position: static;
                padding: 0.5rem 0;
                border-radius: 0;
                background: none;
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
                border: none;
                box-shadow: none;
            }
            .categories-title { display: none; }
            .section-block { margin-bottom: 0.3rem; }
            .section-header { padding: 0.25rem 0.4rem; }
            .section-label { font-size: 0.68rem; }
            .section-categories { display: flex; flex-wrap: wrap; gap: 0.3rem; padding-left: 0.2rem; }
            .section-categories.collapsed { display: none; }
            .category-item {
                padding: 0.4rem 0.7rem;
                font-size: 0.8rem;
                margin-bottom: 0;
                border-radius: 999px;
                border: 1px solid var(--card-border-color);
            }

            .wiki-articles {
                flex: 1;
                width: auto;
                position: static;
                max-height: none;
                overflow-y: visible;
                border-radius: 0;
                background: none;
                backdrop-filter: none;
                -webkit-backdrop-filter: none;
                border: none;
                box-shadow: none;
                padding: 0;
            }
            .articles-title { display: none; }

            #mobileSidebarToggle {
                display: flex;
                position: fixed;
                bottom: 1.5rem;
                right: 1.5rem;
                z-index: 80;
                width: 3.5rem;
                height: 3.5rem;
                border-radius: 1rem;
                align-items: center;
                justify-content: center;
                border: none;
                cursor: pointer;
                background: var(--primary-accent-color);
                color: var(--bg-color);
                box-shadow: 0 4px 15px var(--shadow-color-light);
                transition: transform 0.2s ease;
            }
            #mobileSidebarToggle:active { transform: scale(0.92); }

            .wiki-content-card { padding: 1.25rem; }
        }

        /* ===== GitHub Section ===== */
        .github-section { margin-top: 1.5rem; }

        .github-contrib-chart {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 1.5rem;
        }
        .github-contrib-chart img {
            width: 100%;
            min-width: 600px;
            border-radius: 0.75rem;
        }
        html.dark .github-contrib-chart img {
            filter: invert(1) hue-rotate(180deg);
        }

        .github-stats-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        .github-stats-row img {
            flex: 1;
            min-width: 280px;
            max-width: 100%;
            border-radius: 0.75rem;
        }

        .github-activity h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .activity-list { list-style: none; padding: 0; margin: 0; }

        .activity-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.7rem 0;
            border-bottom: 1px solid var(--card-border-color);
            font-size: 0.88rem;
            line-height: 1.5;
            align-items: flex-start;
        }
        .activity-item:last-child { border-bottom: none; }

        .activity-icon {
            flex-shrink: 0;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--sidebar-hover-bg);
            color: var(--text-muted-color);
            margin-top: 0.1rem;
        }

        .activity-body { flex: 1; min-width: 0; }
        .activity-body strong { color: var(--text-color); }
        .activity-body a {
            color: var(--primary-accent-color);
            text-decoration: none;
            font-weight: 500;
        }
        .activity-body a:hover { text-decoration: underline; }
        .activity-time {
            font-size: 0.76rem;
            color: var(--text-muted-color);
            margin-top: 0.15rem;
        }

        .activity-loading, .activity-empty {
            color: var(--text-muted-color);
            font-size: 0.88rem;
            font-style: italic;
            padding: 0.5rem 0;
        }

        /* ===== Animation ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.3s ease forwards; }

        .content-section { display: none; }
        .content-section.visible { display: block; }
    </style>
</head>
<body>
    <header class="header-frosted sticky top-0 z-40">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            <h1 id="userName" class="text-2xl sm:text-3xl font-bold" style="color: var(--primary-accent-color);"></h1>
            <nav class="main-nav flex items-center relative">
                <button onclick="navigate('home', this)" class="tab" data-tab="home">Home</button>
                <button onclick="navigate('wiki', this)" class="tab" data-tab="wiki">Wiki</button>
                <span id="active-tab-underline"></span>
                <div class="theme-switch-wrapper ml-3">
                    <label class="theme-switch" for="themeToggleCheckbox">
                        <input type="checkbox" id="themeToggleCheckbox" />
                        <span class="slider"></span>
                    </label>
                </div>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 py-6">
        <section id="home" class="content-section">
            <div class="frosted-glass p-6 sm:p-8 fade-in">
                <h2 class="text-2xl sm:text-3xl font-semibold mb-6">About Me</h2>
                <div id="personalInfoContent" class="space-y-4"></div>
            </div>

            <div id="githubSection" class="github-section frosted-glass p-6 sm:p-8 fade-in" style="display:none;">
                <h2 class="text-2xl sm:text-3xl font-semibold mb-6">GitHub</h2>

                <div class="github-contrib-chart">
                    <img id="ghContribChart" alt="GitHub Contribution Graph" loading="lazy">
                </div>

                <div class="github-stats-row">
                    <img id="ghStatsCard" alt="GitHub Stats" loading="lazy" onerror="this.style.display='none'">
                    <img id="ghStreakCard" alt="GitHub Streak" loading="lazy" onerror="this.style.display='none'">
                </div>

                <div class="github-activity">
                    <h3>Recent Activity</h3>
                    <div id="ghActivity"><p class="activity-loading">Loading activity...</p></div>
                </div>
            </div>
        </section>

        <section id="wiki" class="content-section">
            <button id="mobileSidebarToggle" onclick="toggleMobileSidebar()">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
            <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleMobileSidebar()"></div>

            <div class="wiki-layout">
                <div id="wikiSidebar" class="wiki-nav-panels">
                    <nav class="wiki-categories frosted-glass">
                        <h3 class="categories-title">Wiki</h3>
                        <div id="wikiCategories"></div>
                    </nav>
                    <aside class="wiki-articles frosted-glass">
                        <h3 class="articles-title" id="articlesPanelTitle">Articles</h3>
                        <div class="sidebar-search">
                            <svg class="sidebar-search-icon" width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                            <input id="wikiSearch" type="text" placeholder="Search..." oninput="onSearchInput(this.value)">
                            <button class="sidebar-search-clear" id="searchClear" onclick="clearSearch()">
                                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                            </button>
                        </div>
                        <div id="articlesListContent"></div>
                    </aside>
                </div>

                <div class="wiki-content-wrapper">
                    <div id="wikiContent" class="wiki-content-card frosted-glass fade-in">
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center py-8 text-sm" style="color: var(--text-muted-color);">
        <p>&copy; <span id="currentYear"></span> <span id="footerName"></span>. All rights reserved.</p>
    </footer>

    <script>
        let siteConfig = {
            userName: "Leo Xu",
            footerName: "Leo Xu",
            personalInfoHTML: "<p>Welcome to my personal page!</p>",
            githubUsername: ""
        };

        let wikiData = { sections: [] };
        let activeArticleId = null;
        let selectedCategoryId = null;
        let collapsedSections = new Set();
        let searchQuery = '';

        const themeToggle = document.getElementById('themeToggleCheckbox');
        const htmlEl = document.documentElement;

        // ===== Initialization =====
        async function initializeApp() {
            initializeTheme();
            await loadSiteConfig();
            await loadWikiManifest();
            configureMarked();
            initializeGitHub();

            document.getElementById('currentYear').textContent = new Date().getFullYear();
            themeToggle.addEventListener('change', toggleTheme);

            handleRoute();
            window.addEventListener('hashchange', handleRoute);
        }

        document.addEventListener('DOMContentLoaded', initializeApp);

        // ===== Theme =====
        function initializeTheme() {
            const saved = localStorage.getItem('theme');
            if (saved === 'dark') {
                htmlEl.classList.add('dark');
                themeToggle.checked = true;
                updateCodeTheme(true);
            } else {
                htmlEl.classList.remove('dark');
                themeToggle.checked = false;
                updateCodeTheme(false);
            }
        }

        function toggleTheme() {
            const isDark = themeToggle.checked;
            htmlEl.classList.toggle('dark', isDark);
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateCodeTheme(isDark);
        }

        function updateCodeTheme(isDark) {
            document.getElementById('hljs-light').disabled = isDark;
            document.getElementById('hljs-dark').disabled = !isDark;
            updateGitHubTheme(isDark);
        }

        // ===== Config Loading =====
        async function loadSiteConfig() {
            try {
                const resp = await fetch('config.json');
                if (resp.ok) {
                    const cfg = await resp.json();
                    siteConfig = { ...siteConfig, ...cfg };
                }
            } catch (e) { console.warn('Could not load config.json', e); }

            document.getElementById('userName').textContent = siteConfig.userName;
            document.getElementById('footerName').textContent = siteConfig.footerName;
            document.getElementById('personalInfoContent').innerHTML = siteConfig.personalInfoHTML;
        }

        // ===== Wiki Manifest =====
        function getAllCategories() {
            const cats = [];
            for (const sec of (wikiData.sections || [])) {
                for (const cat of (sec.categories || [])) cats.push(cat);
            }
            return cats;
        }

        async function loadWikiManifest() {
            try {
                const resp = await fetch('wiki_manifest.json');
                if (resp.ok) {
                    wikiData = await resp.json();
                    if (!wikiData.sections) {
                        wikiData = { sections: [{ id: 'all', name: 'All', categories: wikiData.categories || [] }] };
                    }
                    const allCats = getAllCategories();
                    if (allCats.length > 0) selectedCategoryId = allCats[0].id;
                }
            } catch (e) { console.warn('Could not load wiki_manifest.json', e); }
        }

        // ===== Marked.js Config =====
        function configureMarked() {
            marked.use({
                breaks: true,
                gfm: true,
                renderer: {
                    code({ text, lang }) {
                        const language = lang && hljs.getLanguage(lang) ? lang : null;
                        let highlighted;
                        try {
                            highlighted = language
                                ? hljs.highlight(text, { language }).value
                                : hljs.highlightAuto(text).value;
                        } catch (e) {
                            highlighted = text;
                        }
                        const copyIcon = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>`;
                        const langLabel = language ? `<span style="position:absolute;top:0.45rem;left:0.75rem;font-size:0.7rem;color:var(--text-muted-color);font-family:inherit;text-transform:uppercase;letter-spacing:0.04em;pointer-events:none;">${language}</span>` : '';
                        return `<div class="code-block-wrapper">${langLabel}<button class="copy-btn" onclick="copyCode(this)" title="Copy">${copyIcon}</button><pre><code class="hljs${language ? ' language-' + language : ''}">${highlighted}</code></pre></div>`;
                    }
                }
            });
        }

        // ===== Routing =====
        function handleRoute() {
            const hash = window.location.hash.slice(1);
            if (hash.startsWith('wiki/')) {
                const articleId = hash.slice(5);
                showSection('wiki');
                selectArticle(articleId);
            } else if (hash === 'wiki') {
                showSection('wiki');
                showWikiWelcome();
            } else {
                showSection('home');
            }
        }

        function navigate(section, tabEl) {
            if (section === 'wiki') {
                window.location.hash = activeArticleId ? `wiki/${activeArticleId}` : 'wiki';
            } else {
                window.location.hash = '';
            }
        }

        // ===== Section Display =====
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('visible'));
            const section = document.getElementById(sectionId);
            if (section) section.classList.add('visible');

            const tabEl = document.querySelector(`.tab[data-tab="${sectionId}"]`);
            updateActiveTab(tabEl);

            if (sectionId === 'wiki') {
                renderCategories();
                renderArticlesList();
                if (!activeArticleId) showWikiWelcome();
            }
        }

        function updateActiveTab(tabEl) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('tab-active-text'));
            const underline = document.getElementById('active-tab-underline');
            if (tabEl) {
                tabEl.classList.add('tab-active-text');
                underline.style.left = tabEl.offsetLeft + 'px';
                underline.style.width = tabEl.offsetWidth + 'px';
            } else {
                underline.style.width = '0px';
            }
        }

        // ===== Search =====
        function onSearchInput(value) {
            searchQuery = value.trim().toLowerCase();
            document.getElementById('searchClear').style.display = searchQuery ? 'block' : 'none';
            renderArticlesList();
        }

        function clearSearch() {
            searchQuery = '';
            document.getElementById('wikiSearch').value = '';
            document.getElementById('searchClear').style.display = 'none';
            renderArticlesList();
        }

        function searchByTag(tag) {
            searchQuery = tag.toLowerCase();
            const input = document.getElementById('wikiSearch');
            if (input) input.value = tag;
            document.getElementById('searchClear').style.display = 'block';
            if (!document.getElementById('wiki').classList.contains('visible')) {
                showSection('wiki');
            }
            renderArticlesList();
        }

        // ===== Copy Code =====
        const copyIconSvg = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
        const checkIconSvg = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>';

        async function copyCode(btn) {
            const code = btn.closest('.code-block-wrapper').querySelector('code');
            try {
                await navigator.clipboard.writeText(code.textContent);
            } catch {
                const ta = document.createElement('textarea');
                ta.value = code.textContent;
                ta.style.cssText = 'position:fixed;opacity:0';
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
            }
            btn.classList.add('copied');
            btn.innerHTML = checkIconSvg;
            setTimeout(() => {
                btn.classList.remove('copied');
                btn.innerHTML = copyIconSvg;
            }, 2000);
        }

        // ===== Categories Column =====
        function renderCategories() {
            const container = document.getElementById('wikiCategories');
            container.innerHTML = '';

            const sections = wikiData.sections || [];
            if (sections.length === 0) {
                container.innerHTML = '<p class="articles-empty">No categories.</p>';
                return;
            }

            sections.forEach(sec => {
                const block = document.createElement('div');
                block.className = 'section-block';

                const isCollapsed = collapsedSections.has(sec.id);

                const header = document.createElement('div');
                header.className = `section-header${isCollapsed ? ' collapsed' : ''}`;
                header.innerHTML = `<span class="section-label">${sec.name}</span><span class="section-chevron">â–¼</span>`;
                header.onclick = () => toggleSection(sec.id);
                block.appendChild(header);

                const list = document.createElement('div');
                list.className = `section-categories${isCollapsed ? ' collapsed' : ''}`;

                (sec.categories || []).forEach(cat => {
                    const item = document.createElement('div');
                    item.className = `category-item${selectedCategoryId === cat.id ? ' active' : ''}`;
                    item.textContent = cat.name;
                    item.onclick = () => selectCategory(cat.id);
                    list.appendChild(item);
                });

                block.appendChild(list);
                container.appendChild(block);
            });
        }

        function toggleSection(sectionId) {
            if (collapsedSections.has(sectionId)) {
                collapsedSections.delete(sectionId);
            } else {
                collapsedSections.add(sectionId);
            }
            renderCategories();
        }

        function selectCategory(catId) {
            selectedCategoryId = catId;
            searchQuery = '';
            const input = document.getElementById('wikiSearch');
            if (input) input.value = '';
            document.getElementById('searchClear').style.display = 'none';
            renderCategories();
            renderArticlesList();
        }

        // ===== Articles Column =====
        function renderArticlesList() {
            const container = document.getElementById('articlesListContent');
            const titleEl = document.getElementById('articlesPanelTitle');
            container.innerHTML = '';

            if (searchQuery) {
                titleEl.textContent = 'Results';
                let results = [];
                getAllCategories().forEach(cat => {
                    (cat.articles || []).forEach(a => {
                        const titleMatch = a.title.toLowerCase().includes(searchQuery);
                        const tagMatch = (a.tags || []).some(t => t.toLowerCase().includes(searchQuery));
                        const catMatch = cat.name.toLowerCase().includes(searchQuery);
                        if (titleMatch || tagMatch || catMatch) results.push(a);
                    });
                });

                if (results.length === 0) {
                    container.innerHTML = '<p class="articles-empty">No matches found.</p>';
                    return;
                }
                results.forEach(article => appendArticleItem(container, article));
                return;
            }

            if (!selectedCategoryId) {
                titleEl.textContent = 'Articles';
                container.innerHTML = '<p class="articles-empty">Select a category.</p>';
                return;
            }

            const cat = getAllCategories().find(c => c.id === selectedCategoryId);
            if (!cat) return;

            titleEl.textContent = cat.name;
            const articles = cat.articles || [];

            if (articles.length === 0) {
                container.innerHTML = '<p class="articles-empty">No articles yet.</p>';
                return;
            }
            articles.forEach(article => appendArticleItem(container, article));
        }

        function appendArticleItem(container, article) {
            const item = document.createElement('div');
            item.className = `sidebar-article${activeArticleId === article.id ? ' active' : ''}`;
            item.textContent = article.title;
            item.onclick = () => {
                window.location.hash = `wiki/${article.id}`;
                closeMobileSidebar();
            };
            container.appendChild(item);
        }

        // ===== Wiki Welcome =====
        function showWikiWelcome() {
            const content = document.getElementById('wikiContent');
            let cardsHtml = '';

            getAllCategories().forEach(cat => {
                const count = cat.articles ? cat.articles.length : 0;
                const firstArticleId = count > 0 ? cat.articles[0].id : null;
                const onclick = firstArticleId
                    ? `onclick="window.location.hash='wiki/${firstArticleId}'"`
                    : '';
                cardsHtml += `
                    <div class="category-card frosted-glass" ${onclick}>
                        <h3>${cat.name}</h3>
                        <p class="card-count">${count} article${count !== 1 ? 's' : ''}</p>
                    </div>`;
            });

            content.innerHTML = `
                <div class="wiki-welcome fade-in">
                    <h2>Wiki</h2>
                    <p>Browse categories or select an article from the sidebar.</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        ${cardsHtml || '<p style="color: var(--text-muted-color);">No categories yet.</p>'}
                    </div>
                </div>`;
        }

        // ===== Select & Render Article =====
        function findArticle(articleId) {
            for (const cat of getAllCategories()) {
                if (cat.articles) {
                    const found = cat.articles.find(a => a.id === articleId);
                    if (found) return { article: found, category: cat };
                }
            }
            return null;
        }

        async function selectArticle(articleId) {
            const result = findArticle(articleId);
            if (!result) {
                document.getElementById('wikiContent').innerHTML = `
                    <div class="wiki-welcome">
                        <h2>Article Not Found</h2>
                        <p>The article you're looking for doesn't exist.</p>
                    </div>`;
                return;
            }

            const { article, category } = result;
            activeArticleId = articleId;
            selectedCategoryId = category.id;
            renderCategories();
            renderArticlesList();

            const contentEl = document.getElementById('wikiContent');
            contentEl.innerHTML = '<p style="color: var(--text-muted-color); font-style: italic; padding: 2rem;">Loading...</p>';

            let rawMarkdown = '';
            if (article.path) {
                try {
                    const resp = await fetch(article.path);
                    if (resp.ok) {
                        rawMarkdown = await resp.text();
                    } else {
                        rawMarkdown = `# Error\n\nCould not load: \`${article.path}\`\nStatus: ${resp.status}`;
                    }
                } catch (e) {
                    rawMarkdown = `# Error\n\nFailed to fetch: \`${article.path}\`\n\n${e}`;
                }
            } else {
                rawMarkdown = article.content || '# Empty Article\n\nNo content available.';
            }

            const basePath = article.path ? article.path.substring(0, article.path.lastIndexOf('/') + 1) : '';
            const html = renderMarkdown(rawMarkdown, basePath);

            const tagsHtml = (article.tags && article.tags.length > 0)
                ? `<div class="article-tags">${article.tags.map(t => `<span class="article-tag" onclick="searchByTag('${t.replace(/'/g, "\\'")}')">${t}</span>`).join('')}</div>`
                : '';

            const metaHtml = `
                <div class="article-meta">
                    <span class="article-category-badge">${category.name}</span>
                    ${article.date ? `<span class="article-date">${formatDate(article.date)}</span>` : ''}
                    ${tagsHtml}
                </div>`;

            contentEl.innerHTML = `<div class="fade-in">${metaHtml}<div class="wiki-viewer">${html}</div></div>`;

            await typesetMath(contentEl);
        }

        function formatDate(dateStr) {
            try {
                const d = new Date(dateStr + 'T00:00:00');
                return d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            } catch { return dateStr; }
        }

        // ===== Markdown Rendering with Obsidian Compatibility =====
        function renderMarkdown(raw, basePath) {
            basePath = basePath || '';
            raw = raw.replace(/^---\s*\n[\s\S]*?\n---\s*\n?/, '');

            const mathBlocks = [];
            let mathIdx = 0;

            function extractMath(text) {
                text = text.replace(/\$\$([\s\S]*?)\$\$/g, (match) => {
                    const key = `\u{E000}DM${mathIdx}\u{E000}`;
                    mathBlocks.push({ key, value: match });
                    mathIdx++;
                    return key;
                });
                text = text.replace(/(?<!\$)\$(?!\$)([^\$\n]+?)\$(?!\$)/g, (match) => {
                    const key = `\u{E000}IM${mathIdx}\u{E000}`;
                    mathBlocks.push({ key, value: match });
                    mathIdx++;
                    return key;
                });
                return text;
            }

            function processHighlights(text) {
                return text.replace(/==(.*?)==/g, '<mark>$1</mark>');
            }

            function processObsidianImages(text) {
                return text.replace(/!\[\[([^\]|]+?)(?:\|([^\]]*))?\]\]/g, (match, path, alt) => {
                    const filename = path.trim();
                    const altText = alt ? alt.trim() : filename.split('/').pop();
                    const resolved = filename.includes('/') ? filename : `pic/${filename}`;
                    return `![${altText}](${resolved.replace(/ /g, '%20')})`;
                });
            }

            function encodeImageSpaces(text) {
                return text.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, (m, alt, url) => {
                    if (/^(https?:\/\/|data:)/.test(url)) return m;
                    return `![${alt}](${url.replace(/ /g, '%20')})`;
                });
            }

            let processed = processOutsideCode(raw, (text) => {
                text = extractMath(text);
                text = processObsidianImages(text);
                text = encodeImageSpaces(text);
                text = processHighlights(text);
                return text;
            });

            let html = marked.parse(processed);
            html = processCallouts(html);

            mathBlocks.forEach(({ key, value }) => {
                html = html.split(key).join(value);
            });

            if (basePath) {
                html = resolveImagePaths(html, basePath);
            }

            return html;
        }

        function resolveImagePaths(html, basePath) {
            return html.replace(/<img\s+([^>]*?)src="([^"]+)"([^>]*?)>/gi, (match, before, src, after) => {
                if (/^(https?:\/\/|\/|data:)/.test(src)) return match;
                return `<img ${before}src="${basePath}${src}"${after}>`;
            });
        }

        function processOutsideCode(markdown, processor) {
            const parts = markdown.split(/(```[\s\S]*?```|`[^`\n]+`)/g);
            return parts.map(part => {
                if ((part.startsWith('```') && part.endsWith('```')) ||
                    (part.startsWith('`') && part.endsWith('`') && part.length > 1 && !part.startsWith('```'))) {
                    return part;
                }
                return processor(part);
            }).join('');
        }

        function processCallouts(html) {
            return html.replace(
                /<blockquote>([\s\S]*?)<\/blockquote>/g,
                (match, inner) => {
                    const calloutMatch = inner.match(/^\s*<p>\s*\[!([\w-]+)\]\s*([\s\S]*)/);
                    if (!calloutMatch) return match;

                    const type = calloutMatch[1].toLowerCase();
                    let rest = calloutMatch[2];

                    let title = type.charAt(0).toUpperCase() + type.slice(1);
                    const titleMatch = rest.match(/^([^\n<]*?)(?:<br\s*\/?>|<\/p>)([\s\S]*)/);
                    if (titleMatch) {
                        if (titleMatch[1].trim()) title = titleMatch[1].trim();
                        rest = titleMatch[2];
                    } else {
                        const singleLine = rest.replace(/<\/p>\s*$/, '').trim();
                        if (singleLine) title = singleLine;
                        rest = '';
                    }

                    rest = rest.replace(/^\s*<p>/, '').replace(/<\/p>\s*$/, '');

                    return `<div class="callout callout-${type}">
                        <div class="callout-header">${title}</div>
                        ${rest.trim() ? `<div class="callout-body"><p>${rest}</p></div>` : ''}
                    </div>`;
                }
            );
        }

        // ===== MathJax Typesetting =====
        async function typesetMath(element) {
            if (window.MathJax) {
                if (MathJax.typesetPromise) {
                    try {
                        MathJax.typesetClear([element]);
                        await MathJax.typesetPromise([element]);
                    } catch (e) { console.warn('MathJax typesetting error:', e); }
                }
            }
        }

        // ===== GitHub Integration =====
        function initializeGitHub() {
            const user = siteConfig.githubUsername;
            if (!user) return;

            document.getElementById('githubSection').style.display = '';
            const isDark = htmlEl.classList.contains('dark');

            document.getElementById('ghContribChart').src = `https://ghchart.rshah.org/${user}`;
            setGitHubCardSrcs(user, isDark);
            loadGitHubActivity(user);
        }

        function setGitHubCardSrcs(user, isDark) {
            const colors = isDark
                ? 'title_color=e8e8e8&text_color=999999&icon_color=e8e8e8'
                : 'title_color=1a1a1a&text_color=666666&icon_color=1a1a1a';
            const base = `bg_color=00000000&hide_border=true&border_radius=12&${colors}`;

            const statsEl = document.getElementById('ghStatsCard');
            const streakEl = document.getElementById('ghStreakCard');

            if (statsEl) {
                statsEl.src = `https://github-readme-stats.vercel.app/api?username=${user}&show_icons=true&include_all_commits=true&${base}`;
            }
            if (streakEl) {
                const streakColors = isDark
                    ? 'background=00000000&ring=e8e8e8&fire=e8e8e8&currStreakLabel=e8e8e8&sideLabels=999999&currStreakNum=e8e8e8&sideNums=999999&dates=666666'
                    : 'background=00000000&ring=1a1a1a&fire=1a1a1a&currStreakLabel=1a1a1a&sideLabels=666666&currStreakNum=1a1a1a&sideNums=666666&dates=999999';
                streakEl.src = `https://streak-stats.demolab.com/?user=${user}&hide_border=true&border_radius=12&${streakColors}`;
            }
        }

        function updateGitHubTheme(isDark) {
            const user = siteConfig.githubUsername;
            if (!user) return;
            setGitHubCardSrcs(user, isDark);
        }

        async function loadGitHubActivity(user) {
            const container = document.getElementById('ghActivity');
            try {
                const resp = await fetch(`https://api.github.com/users/${user}/events/public?per_page=30`);
                if (!resp.ok) throw new Error(resp.status);
                const events = await resp.json();

                const relevant = events.filter(e => {
                    const validTypes = ['PushEvent', 'CreateEvent', 'IssuesEvent', 'PullRequestEvent',
                        'WatchEvent', 'ForkEvent', 'ReleaseEvent', 'IssueCommentEvent'];
                    if (!validTypes.includes(e.type)) return false;
                    if (e.type === 'PushEvent' && (!e.payload.commits || e.payload.commits.length === 0)) return false;
                    return true;
                }).slice(0, 8);

                if (relevant.length === 0) {
                    container.innerHTML = '<p class="activity-empty">No recent public activity.</p>';
                    return;
                }

                let html = '<ul class="activity-list">';
                relevant.forEach(ev => {
                    const { icon, text } = formatEvent(ev);
                    const repo = ev.repo.name;
                    const repoUrl = `https://github.com/${repo}`;
                    const time = timeAgo(new Date(ev.created_at));

                    html += `<li class="activity-item">
                        <span class="activity-icon">${icon}</span>
                        <div class="activity-body">
                            <div>${text} <a href="${repoUrl}" target="_blank" rel="noopener">${repo.split('/')[1]}</a></div>
                            <div class="activity-time">${time}</div>
                        </div>
                    </li>`;
                });
                html += '</ul>';
                container.innerHTML = html;
            } catch (e) {
                container.innerHTML = '<p class="activity-empty">Could not load activity.</p>';
            }
        }

        function formatEvent(ev) {
            const icons = {
                PushEvent: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/></svg>',
                CreateEvent: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>',
                IssuesEvent: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>',
                PullRequestEvent: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M13 6h3a2 2 0 0 1 2 2v7"/><line x1="6" y1="9" x2="6" y2="21"/></svg>',
                WatchEvent: '<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>',
                ForkEvent: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><circle cx="18" cy="6" r="3"/><path d="M18 9v1a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V9"/><line x1="12" y1="12" x2="12" y2="15"/></svg>',
                ReleaseEvent: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>',
                IssueCommentEvent: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>'
            };

            const icon = icons[ev.type] || icons.CreateEvent;
            let text = '';
            const p = ev.payload;

            switch (ev.type) {
                case 'PushEvent': {
                    const n = p.commits ? p.commits.length : 0;
                    text = `Pushed <strong>${n} commit${n !== 1 ? 's' : ''}</strong> to`;
                    break;
                }
                case 'CreateEvent':
                    text = `Created ${p.ref_type}${p.ref ? ` <strong>${p.ref}</strong> in` : ''}`;
                    break;
                case 'IssuesEvent':
                    text = `${capitalize(p.action)} issue <strong>#${p.issue?.number || ''}</strong> in`;
                    break;
                case 'PullRequestEvent':
                    text = `${capitalize(p.action)} PR <strong>#${p.pull_request?.number || ''}</strong> in`;
                    break;
                case 'WatchEvent':
                    text = 'Starred';
                    break;
                case 'ForkEvent':
                    text = 'Forked';
                    break;
                case 'ReleaseEvent':
                    text = `${capitalize(p.action)} release in`;
                    break;
                case 'IssueCommentEvent':
                    text = `Commented on issue <strong>#${p.issue?.number || ''}</strong> in`;
                    break;
                default:
                    text = `${ev.type.replace('Event', '')} in`;
            }
            return { icon, text };
        }

        function capitalize(s) { return s ? s.charAt(0).toUpperCase() + s.slice(1) : ''; }

        function timeAgo(date) {
            const seconds = Math.floor((Date.now() - date.getTime()) / 1000);
            const intervals = [
                [31536000, 'year'], [2592000, 'month'], [604800, 'week'],
                [86400, 'day'], [3600, 'hour'], [60, 'minute']
            ];
            for (const [secs, label] of intervals) {
                const count = Math.floor(seconds / secs);
                if (count >= 1) return `${count} ${label}${count > 1 ? 's' : ''} ago`;
            }
            return 'just now';
        }

        // ===== Mobile Sidebar =====
        function toggleMobileSidebar() {
            const panel = document.getElementById('wikiSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            panel.classList.toggle('open');
            overlay.classList.toggle('open');
        }

        function closeMobileSidebar() {
            const panel = document.getElementById('wikiSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (panel) panel.classList.remove('open');
            if (overlay) overlay.classList.remove('open');
        }
    </script>
</body>
</html>
